<?xml version="1.0" encoding="UTF-8"?>

<component name="nuxeo.extensions.fact-fact" version="1.0.0">
  <require>org.nuxeo.runtime.started</require>
  <extension target="org.nuxeo.ecm.core.schema.TypeService" point="schema">
    <schema name="facturae" prefix="facturae" override="true" src="data/schemas/facturae.xsd"/>
    <schema name="Esq_Factura" prefix="Esq_Factura" override="true" src="data/schemas/Esq_Factura.xsd"/>
  </extension>
  <extension target="org.nuxeo.ecm.core.schema.TypeService" point="doctype">
    <doctype name="Facturae" extends="Document">
      <schema name="facturae"/>
      <schema name="dublincore"/>
      <schema name="common"/>
      <schema name="uid"/>
      <schema name="Esq_Factura"/>
    </doctype>
  </extension>
  <extension target="org.nuxeo.ecm.core.lifecycle.LifeCycleService" point="types">
    <types>
      <type name="Facturae">default</type>
    </types>
  </extension>
  <extension target="org.nuxeo.ecm.platform.types.TypeService" point="types">
    <type id="Facturae">
      <label>Facturae</label>
      <description></description>
      <default-view>view_documents</default-view>
      <layouts mode="create">
        <layout>layout@Facturae-create</layout>
      </layouts>
      <layouts mode="edit">
        <layout>layout@Facturae-edit</layout>
      </layouts>
      <layouts mode="view">
        <layout>layout@Facturae-view</layout>
      </layouts>
    </type>
    <type id="Folder">
      <subtypes>
        <type>Facturae</type>
      </subtypes>
    </type>
    <type id="Workspace">
      <subtypes>
        <type>Facturae</type>
      </subtypes>
    </type>
  </extension>
  <extension target="org.nuxeo.ecm.platform.actions.ActionService" point="actions"/>
  <extension target="org.nuxeo.ecm.platform.jbpm.core.JbpmService" point="typeFilter">
    <type name="Facturae">
      <processDefinition>review_parallel</processDefinition>
      <processDefinition>review_approbation</processDefinition>
    </type>
  </extension>
  <extension target="org.nuxeo.ecm.platform.forms.layout.WebLayoutManager" point="layouts">
    <layout name="layout@Facturae-create">
      <templates>
        <template mode="any">/layouts/fact-fact_layout_template.xhtml</template>
      </templates>
      <rows>
        <row>
          <properties mode="any">
            <property name="nxl_colspan_0">1</property>
          </properties>
          <widget>title</widget>
        </row>
        <row>
          <properties mode="any">
            <property name="nxl_colspan_0">1</property>
          </properties>
          <widget>Arch_XML</widget>
        </row>
      </rows>
      <widget name="title" type="text">
        <labels>
          <label mode="any">Title</label>
        </labels>
        <translated>false</translated>
        <fields>
          <field>dc:title</field>
        </fields>
        <properties widgetMode="edit">
          <property name="styleClass">dataInputText</property>
        </properties>
        <properties widgetMode="view">
          <property name="styleClass">dataInputText</property>
        </properties>
      </widget>
      <widget name="Arch_XML" type="file">
        <labels>
          <label mode="any">XML</label>
        </labels>
        <translated>false</translated>
        <fields>
          <field>Esq_Factura:Arch_XML</field>
          <field>Esq_Factura:Arch_XML/filename</field>
        </fields>
        <properties widgetMode="edit">
          <!-- <property name="required">true</property> -->
        </properties>
      </widget>
    </layout>
    <layout name="layout@Facturae-edit">
      <templates>
        <template mode="any">/layouts/fact-fact_layout_template.xhtml</template>
      </templates>
      <rows>
        <row>
          <properties mode="any">
            <property name="nxl_colspan_0">1</property>
          </properties>
          <widget>title</widget>
        </row>
        <row>
          <properties mode="any">
            <property name="nxl_colspan_0">1</property>
          </properties>
          <widget>Arch_XML</widget>
        </row>
      </rows>
      <widget name="title" type="text">
        <labels>
          <label mode="any">Title</label>
        </labels>
        <translated>false</translated>
        <fields>
          <field>dc:title</field>
        </fields>
        <properties widgetMode="edit">
          <property name="styleClass">dataInputText</property>
        </properties>
        <properties widgetMode="view">
          <property name="styleClass">dataInputText</property>
        </properties>
      </widget>
      <widget name="Arch_XML" type="file">
        <labels>
          <label mode="any">XML</label>
        </labels>
        <translated>false</translated>
        <fields>
          <field>Esq_Factura:Arch_XML</field>
          <field>Esq_Factura:Arch_XML/filename</field>
        </fields>
        <properties widgetMode="edit">
          <!-- <property name="required">true</property> -->
        </properties>
      </widget>
    </layout>
    <layout name="layout@Facturae-view">
      <templates>
        <template mode="any">/layouts/fact-fact_layout_template.xhtml</template>
      </templates>
      <rows>
        <row>
          <properties mode="any">
            <property name="nxl_colspan_0">1</property>
          </properties>
          <widget>title</widget>
        </row>
        <row>
          <properties mode="any">
            <property name="nxl_colspan_0">1</property>
          </properties>
          <widget>Arch_XML</widget>
        </row>
        <row>
          <properties mode="any">
            <property name="nxl_colspan_0">1</property>
          </properties>
          <widget>FileHeader_SchemaVersion</widget>
        </row>
        <row>
          <properties mode="any">
            <property name="nxl_colspan_0">1</property>
          </properties>
          <widget>FileHeader_Modality</widget>
        </row>
        <row>
          <properties mode="any">
            <property name="nxl_colspan_0">1</property>
          </properties>
          <widget>FileHeader_InvoiceIssuerType</widget>
        </row>
        <row>
          <properties mode="any">
            <property name="nxl_colspan_0">1</property>
          </properties>
          <widget>FileHeader_Batch_BatchIdentifier</widget>
        </row>
        <row>
          <properties mode="any">
            <property name="nxl_colspan_0">1</property>
          </properties>
          <widget>FileHeader_Batch_InvoicesCount</widget>
        </row>
        <row>
          <properties mode="any">
            <property name="nxl_colspan_0">1</property>
          </properties>
          <widget>FileHeader_Batch_TotalInvoicesAmount_TotalAmount</widget>
        </row>
        <row>
          <properties mode="any">
            <property name="nxl_colspan_0">1</property>
          </properties>
          <widget>Parties_SellerParty_TaxIdentification_PersonTypeCode</widget>
        </row>
        <row>
          <properties mode="any">
            <property name="nxl_colspan_0">1</property>
          </properties>
          <widget>Invoices_Invoice_TaxesOutputs_Tax_TaxableBase_TotalAmount</widget>
        </row>
      </rows>
      <widget name="title" type="text">
        <labels>
          <label mode="any">Title</label>
        </labels>
        <translated>false</translated>
        <fields>
          <field>dc:title</field>
        </fields>
        <properties widgetMode="edit">
          <property name="styleClass">dataInputText</property>
          <property name="required">true</property>
        </properties>
        <properties widgetMode="view">
          <property name="styleClass">dataInputText</property>
        </properties>
      </widget>
      <widget name="Arch_XML" type="file">
        <labels>
          <label mode="any">XML</label>
        </labels>
        <translated>false</translated>
        <fields>
          <field>Esq_Factura:Arch_XML</field>
          <field>Esq_Factura:Arch_XML/filename</field>
        </fields>
      </widget>
      <widget name="FileHeader_SchemaVersion" type="text">
        <labels>
          <label mode="any">label.SchemaVersion</label>
        </labels>
        <translated>true</translated>
        <fields>
          <field>Esq_Factura:FileHeader_SchemaVersion</field>
        </fields>
      </widget>
      <widget name="FileHeader_Modality" type="text">
        <labels>
          <label mode="any">label.Modality</label>
        </labels>
        <translated>true</translated>
        <fields>
          <field>Esq_Factura:FileHeader_Modality</field>
        </fields>
      </widget>
      <widget name="FileHeader_InvoiceIssuerType" type="text">
        <labels>
          <label mode="any">label.InvoiceIssuerType</label>
        </labels>
        <translated>true</translated>
        <fields>
          <field>Esq_Factura:FileHeader_InvoiceIssuerType</field>
        </fields>
      </widget>
      <widget name="FileHeader_Batch_BatchIdentifier" type="text">
        <labels>
          <label mode="any">label.BatchIdentifier</label>
        </labels>
        <translated>true</translated>
        <fields>
          <field>Esq_Factura:FileHeader_Batch_BatchIdentifier</field>
        </fields>
      </widget>
      <widget name="FileHeader_Batch_InvoicesCount" type="text">
        <labels>
          <label mode="any">label.InvoicesCount</label>
        </labels>
        <translated>true</translated>
        <fields>
          <field>Esq_Factura:FileHeader_Batch_InvoicesCount</field>
        </fields>
      </widget>
      <widget name="FileHeader_Batch_TotalInvoicesAmount_TotalAmount" type="text">
        <labels>
          <label mode="any">label.TotalInvoicesAmount_TotalAmount</label>
        </labels>
        <translated>true</translated>
        <fields>
          <field>Esq_Factura:FileHeader_Batch_TotalInvoicesAmount_TotalAmount</field>
        </fields>
      </widget>
      <widget name="Parties_SellerParty_TaxIdentification_PersonTypeCode" type="text">
        <labels>
          <label mode="any">label.PersonTypeCode</label>
        </labels>
        <translated>true</translated>
        <fields>
          <field>Esq_Factura:Parties_SellerParty_TaxIdentification_PersonTypeCode</field>
        </fields>
      </widget>
      <widget name="Invoices_Invoice_TaxesOutputs_Tax_TaxableBase_TotalAmount" type="text">
        <labels>
          <label mode="any">label.TaxableBase_TotalAmount</label>
        </labels>
        <translated>true</translated>
        <fields>
          <field>Esq_Factura:Invoices_Invoice_TaxesOutputs_Tax_TaxableBase_TotalAmount</field>
        </fields>
      </widget>
    </layout>
  </extension>
  <extension target="org.nuxeo.ecm.core.operation.OperationServiceComponent" point="event-handlers">
    <handler chainId="Automation_Facturae">
      <event>documentCreated</event>
      <!-- <event>documentModified</event> -->
      <filters>
        <doctype>Facturae</doctype>
        <!-- <condition>CurrentUser.name!='OtherUser'</condition> -->
      </filters>
    </handler>
  </extension>
  <extension target="org.nuxeo.ecm.platform.ec.notification.service.NotificationService" point="templates">
    <template name="appReviewStarted" src="data/templates/appReviewStarted.ftl"/>
    <template name="defaultNotifTemplate" src="data/templates/defaultNotifTemplate.ftl"/>
    <template name="emailDocument" src="data/templates/emailDocument.ftl"/>
    <template name="modif" src="data/templates/modif.ftl"/>
    <template name="publish" src="data/templates/publish.ftl"/>
    <template name="subscriptionsUpdated" src="data/templates/subscriptionsUpdated.ftl"/>
    <template name="workflow" src="data/templates/workflow.ftl"/>
    <template name="workflowTaskAssigned" src="data/templates/workflowTaskAssigned.ftl"/>
    <template name="workflowTaskDelegated" src="data/templates/workflowTaskDelegated.ftl"/>
  </extension>
  <extension target="org.nuxeo.ecm.platform.forms.layout.WebLayoutManager" point="widgettypes">

    
    <documentation></documentation>

    
    <widgetType name="header">
      
      <configuration>
        
        <title>Header</title>
        
        <description>
          The header widget just displays the widget label.
        </description>
        
        <supportedModes>
          
          <mode>edit</mode>
          
          <mode>view</mode>
        
        </supportedModes>
        
        <fields>
          
          <list>false</list>
          
          <complex>false</complex>
          
          <supportedTypes/>
          
          <defaultTypes/>
        
        </fields>
        
        <handlingLabels>true</handlingLabels>
        
        <categories>
          
          <category>document</category>
        
        </categories>
        
        <properties>
          
          <layouts mode="any">
            
            <layout name="header_widget_type_properties_any">
              
              <rows>
                
                <row>
                  
                  <widget>styleClass</widget>
                
                </row>
                
                <row>
                  
                  <widget>style</widget>
                
                </row>
              
              </rows>
              
              <widget name="styleClass" type="text">
                
                <labels>
                  
                  <label mode="any">Style class</label>
                
                </labels>
                
                <fields>
                  
                  <field>styleClass</field>
                
                </fields>
              
              </widget>
              
              <widget name="style" type="text">
                
                <labels>
                  
                  <label mode="any">Style</label>
                
                </labels>
                
                <fields>
                  
                  <field>style</field>
                
                </fields>
              
              </widget>
            
            </layout>
          
          </layouts>
        
        </properties>
      
      </configuration>
      
      <handler-class>
        org.nuxeo.ecm.platform.forms.layout.facelets.plugins.TemplateWidgetTypeHandler
      </handler-class>
      
      <property name="template">
        /widgets/header_widget.xhtml
      </property>
    
    </widgetType>

    
    <widgetType name="filesList">
      
      <configuration>
        
        <title>Files</title>
        
        <description>
          
          <p>
            The Files displays an editable list of files, using javascript to
            keep the uploaded file path when adding several files in a row.
          </p>
          
          <p>Items are defined using sub wigdets configuration.</p>
          
          <p>
            This is actually a template widget type whose template uses a
            &lt;nxu:inputList /&gt; tag in edit or create mode, and a table
            iterating over items in other modes.
          </p>
        
        </description>
        
        <categories>
          
          <category>document</category>
        
        </categories>
        
        <supportedModes>
          
          <mode>edit</mode>
          
          <mode>view</mode>
        
        </supportedModes>
        
        <acceptingSubWidgets>true</acceptingSubWidgets>
        
        <fields>
          
          <list>true</list>
          
          <complex>false</complex>
          
          <supportedTypes>
            
            <type>blob</type>
          
          </supportedTypes>
          
          <defaultTypes>
            
            <type>blob</type>
          
          </defaultTypes>
        
        </fields>
        
        <properties>
          
          <layouts mode="edit">
            
            <layout name="list_widget_type_properties_edit">
              
              <rows>
                
                <row>
                  
                  <widget>required</widget>
                
                </row>
                
                <row>
                  
                  <widget>diff</widget>
                
                </row>
              
              </rows>
              
              <widget name="required" type="checkbox">
                
                <labels>
                  
                  <label mode="any">Required</label>
                
                </labels>
                
                <fields>
                  
                  <field>required</field>
                
                </fields>
              
              </widget>
              
              <widget name="diff" type="checkbox">
                
                <labels>
                  
                  <label mode="any">Diff</label>
                
                </labels>
                
                <fields>
                  
                  <field>diff</field>
                
                </fields>
              
              </widget>
            
            </layout>
          
          </layouts>
        
        </properties>
      
      </configuration>
      
      <handler-class>
        org.nuxeo.ecm.platform.forms.layout.facelets.plugins.TemplateWidgetTypeHandler
      </handler-class>
      
      <property name="template">/widgets/files_list_widget_template.xhtml
      </property>
    
    </widgetType>

  
  </extension>
</component>
